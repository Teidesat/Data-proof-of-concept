\documentclass[11pt,a4paper]{article}
\usepackage{tikz}
\usepackage{ifthen}
\usetikzlibrary{arrows.meta}

\def\Register((#1, #2), #3, #4) {
	\pgfmathsetmacro\registerName{#4};
	\draw (#1, #2) -- (#1 + #3, #2) -- (#1 + #3, #2 + #3) -- (#1, #2 + #3) -- (#1, #2);
	\node[scale={1.5 * #3}] at (#1 + #3 / 2, #2 + #3 / 2) {$D_{\registerName}$};
}

\def\Xor((#1, #2), #3) {
	\draw (#1, #2) circle (#3);
	\draw (#1 + #3, #2     ) -- (#1 - #3, #2);
	\draw (#1     , #2 + #3) -- (#1     , #2 - #3);
}

\def\Arrow((#1, #2), (#3, #4)) {
	\draw[-latex] (#1, #2) -- (#3, #4);
}

\def\ReturnArrow((#1, #2), (#3, #4), #5, #6, #7) { % Start, End, Radius, Height, Diff
	\pgfmathparse{#5 + #7};
	\edef\rarrowdx{\pgfmathresult};
	\pgfmathparse{#6 - (#4)};
	\edef\rarrowdy{\pgfmathresult};
	\pgfmathparse{atan(\rarrowdy/\rarrowdx)};
	\edef\rarrowatan{\pgfmathresult};
	\pgfmathparse{(#3) + (#5) * cos(\rarrowatan)};
	\edef\rarrowx{\pgfmathresult};
	\pgfmathparse{(#4) + (#5) * sin(\rarrowatan)};
	\edef\rarrowy{\pgfmathresult};
	
	\draw[{Circle[length=3]}-] (#1, #2 - 0.05) |- (#3 + #5 + #7, #6);
	\draw[-latex] (#3 + #5 + #7, #6) -- (\rarrowx, \rarrowy);
}

\begin{document}
	
	\section{RSC Structure}
	\begin{tikzpicture}
	
	\def\r{0.3};
	\def\s{1};
	\def\sqSize{1};
	\def\memorySize{3};
	\def\height{\sqSize / 2 + \s};
	
	\pgfmathsetmacro\loop{\memorySize - 1};
	\pgfmathsetmacro\heightInv{-1 * (\height)};
	
	% Input
	\Arrow((0, 0), (\s, 0))
	
	% Inside
	\foreach \i in {0,...,\loop}
	{
		\def\x{\s + \r * 2 + \s * \i + \sqSize * \i};
		
		\ifthenelse{\i = 0}
			{
				\draw[-latex] (\x + \s / 2 - \r, \height) -| (\s + \r, \r);
			}
			{}
		
		\ifthenelse{\i = \loop}
			{
				\draw[-latex] (\x + \s * 1.5 - \r + \sqSize, \height) -- (\x + \s / 2 + \r, \height);
				\Xor((\x + \s * 1.5 + \sqSize, \height), \r)
				\draw[{Circle[length=3]}-latex] (\x + \s * 1.5 + \sqSize, -0.05) -- (\x + \s * 1.5 + \sqSize, \height - \r);
			}
			{
				\draw[-latex] (\x + \s / 2 - \r + \s + \sqSize, \height) -- (\x + \s / 2 + \r, \height);
			}
		
		\Arrow((\x, 0), (\x + \s, 0))
		\draw[{Circle[length=3]}-latex] (\x + \s / 2, -0.05) -- (\x + \s / 2, \height - \r);		\draw[{Circle[length=3]}-latex] (\x + \s / 2, +0.05) -- (\x + \s / 2, \heightInv + \r);
		\Xor((\x + \s / 2, \height), \r)
		\Xor((\x + \s / 2, \heightInv), \r)
		\Register((\x + \s, 0 - \sqSize / 2), \sqSize, \i)
	}
	
	% Inside most right arrows
	\def\x{\s + \r * 2 + \s * \memorySize + \sqSize * \memorySize};
	
	\draw[-latex] (\x + \s / 2, 0) -- (\s / 2 + \x, \heightInv + \r);
	\Arrow((\x, 0), (\x + \s / 2, 0))
	
	% Outside Xors
	\Xor((\s + \r, 0), \r)
	\Xor((\s / 2 + \x, \heightInv), \r)
	
	% Outputs
	\draw[{Circle[length=3]}-latex] (\s / 2, 0 - 0.05) |- ({(\memorySize + 2) * (\s + \sqSize)}, \height + \s) node [right, above, sloped] {$X_k$};
	\draw[-latex] (\s / 2 + \x + \r, \heightInv) |- ({(\memorySize + 2) * (\s + \sqSize)}, \heightInv) node [right, above, sloped] {$Y_k$};
	
	\end{tikzpicture}
	
\end{document}

